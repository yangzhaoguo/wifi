<!DOCTYPE html>
<!--[if lt IE 7]>
<html class="ie6 oldie" lang="zh"><![endif]-->
<!--[if IE 7]>
<html class="ie7 oldie" lang="zh"><![endif]-->
<!--[if IE 8]>
<html class="ie8 oldie" lang="zh"><![endif]-->
<!--[if gt IE 8]><!-->
<html lang="zh"> <!--<![endif]-->
<head>
    <meta http-equiv="X-UA-Compatible" content="edge"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="renderer" content="webkit">
    <link rel="icon" href="../logo_ico.ico" type="img/x-ico"/>
    <!--[if lt IE 7]>
    <![endif]-->
    <!--[if gte IE 9]>
    <style>
        body {
            filter: none;
        }
    </style>
    <![endif]-->
    <title>灵铱路由器</title>
    <meta name="viewport" content="width=1200">
    <link href="/xuci/assets/css/bc.css-v=0.0.3.css" rel="stylesheet">
    <link href="/xuci/assets/css/qos.css-v=0.0.3.css" rel="stylesheet">
    <link href="/xuci/assets/css/index.css-v=0.0.3.css" rel="stylesheet">
    <link href="/xuci/assets/css/safe.css?v=0.0.3" rel="stylesheet">
</head>
<body>
<div id="doc">

    <noscript>
        <div class="noscript">你的浏览器禁止了Javascript功能，会造成无法使用系统进行路由器管理，请开启。</div>
    </noscript>
    <script>
        var GLOBALHEADER = true;
    </script>
    <div id="hd">
        <div class="inner">
            <div class="mod-head clearfix">
                <h1 id="logo">
                    <a href="../home.html">
                        <img src="/xuci/assets/img/logo.png" alt="灵铱路由器">
                    </a>
                </h1>
                <div id="nav">
                    <ul>
                        <li>
                            <a href="../home.html">路由状态</a>
                        </li>

                        <li class="active">
                            <a href="wifi.html">常用设置</a>
                        </li>
                        <li>
                            <a href="../prosetting/qos.html">高级设置</a>
                        </li>
                    </ul>

                </div>
                <!--<div id="userbar">-->

                <!--<span id="sysmenu" class="name s-dropdown">Xiaomi_B504 (家)</span>-->
                <!--<span id="sysnotice" class="ico-notice"></span>-->
                <!--</div>-->
            </div>
        </div>
    </div>
    <div style="width: 1160px;margin: auto;">
        <div class="mod-set-nav">
            <ul class="clearfix li-5">
                <li>
                    <a href="wifi.html">
                        <i class="ico ico-1"></i>
                        <span>Wi-Fi设置</span>
                    </a>
                </li>
                <li>
                    <a href="./wan.html">
                        <i class="ico ico-2"></i>
                        <span>上网设置</span>
                    </a>
                </li>
                <li class="active">
                    <a href="safe.html">
                        <i class="ico ico-3"></i>
                        <span>安全中心</span>
                    </a>
                </li>
                <li>
                    <a href="lannetset.html">
                        <i class="ico ico-4"></i>
                        <span>局域网设置</span>
                    </a>
                </li>
                <li>
                    <a href="upgrade.html">
                        <i class="ico ico-5"></i>
                        <span>系统状态</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>


    <div id="bd">
        <!--<div class="mod-set mod-password">-->
            <!--<div class="hd">-->
                <!--<h3>设置用户名</h3>-->
            <!--</div>-->
            <!--<div class="bd">-->
                <!--<form action="#" class="form form-password" name="setRouterPwd" id="" autocomplete="off">-->
                    <!--<div class="form-item form-item-empty">-->
                        <!--<label class="k">用户名</label>-->
                        <!--<span class="v"><input type="text" class="ipt-text" id="username" datatype="bytetext"-->
                                               <!--maxlength="63" autocomplete="off"></span>-->
                        <!--<em class="t"></em>-->
                    <!--</div>-->
                    <!--<div class="form-contral">-->
                        <!--<button type="submit" style="display: block" class="btn btn-l btn-primary"><span>保存</span>-->
                        <!--</button>-->
                    <!--</div>-->
                <!--</form>-->
            <!--</div>-->
        <!--</div>-->
        <div class="mod-set mod-password">
            <div class="hd">
                <h3>修改管理密码</h3>
            </div>
            <div class="bd">
                <form action="#" class="form form-password" name="setRouterPwd" id="setRouterPwd" autocomplete="off">
                    <div class="form-item form-item-empty" id="oldpwdbox">
                        <label class="k">原密码</label>
                        <span class="v"><input type="password" name="oldPwd" class="ipt-text" datatype="bytetext"
                                               maxlength="63" reqmsg="原密码" autocomplete="off"></span>
                        <em class="t"></em>
                    </div>
                    <div class="form-item form-item-empty">
                        <label class="k">新密码</label>
                        <span class="v"><input type="password" name="newPwd" id="newPwd" class="ipt-text" maxlength="63"
                                               datatype="bytetext" minlength="8" reqmsg="新密码" autocomplete="off"></span>
                        <em class="t"></em>
                    </div>
                    <div class="form-item form-item-empty">
                        <label class="k">确认密码</label>
                        <span class="v"><input type="password" name="newPwd2" class="ipt-text" maxlength="63"
                                               datatype="reconfirm" reconfirmfor="newPwd" reqmsg="确认密码"
                                               autocomplete="off"></span>
                        <em class="t"></em>
                    </div>
                    <div class="form-contral">
                        <button type="submit" id="btnSetRouterPwd" class="btn btn-l btn-primary"><span>保存</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="ft">
        <p class="rom-ver">系统版本: 2.25.122 开发版  MAC地址: 78:11:DC:4C:B5:04</p>
        <p>&copy; 2018 灵铱路由器</p>
    </div>
    <script type="text/template" id="ft_template">
        <p class="rom-ver">系统版本: <%=(data.fv)%> 开发版  MAC地址: <%=(data.mac)%></p>
        <p>&copy; 2018 灵铱路由器</p>
    </script>


</div>


<!--[if lt IE 7]>
<script>
    try {
        document.execCommand("BackgroundImageCache", false, true);
    } catch (e) {
    }
</script>
<![endif]-->
<div class="mask-menu" id="maskMenu"
     style="position:fixed;left:0;top:0; width:100%; height:100%; z-index:2; display:none;"></div>
<div id="dropmenu" class="dropmenu" style="z-index:3; display:none;">
    <ul>
        <li><a href="#" id="toRename">修改路由器名称</a></li>

        <li><a href="upgrade.htm"
               tppabs="http://192.168.31.1/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/web/setting/upgrade">系统升级</a>
        </li>

        <li><a href="#" id="toDownloadClient">下载客户端</a></li>
        <li><a href="#" id="toReboot">重启</a></li>

        <li class="last"><a
                href="javascript:if(confirm('http://192.168.31.1/cgi-bin/luci  \n\n���ļ��޷��� Teleport Ultra ����, ��Ϊ ����һ�����·���ⲿ������Ϊ������ʼ��ַ�ĵ�ַ��  \n\n�����ڷ������ϴ���?'))window.location='../../cgi-bin/luci'"
                tppabs="http://192.168.31.1/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/web/logout">注销</a></li>
    </ul>
</div>
<div id="noticebar" class="noticebar" style="z-index:3; display:none;">
    <i class="ico-arrow"></i>
    <div class="content"></div>
</div>
<script>
    var i18n = {};
    i18n.dialog = {
        ok: '确认',
        cancel: '取消',
        loading: '加载中...',
        dlgtitle: '消息框'
    };
    i18n.valid = {
        n_integer: '请输入一个{$0}位正整数。',
        n_format: '数字输入格式为&#34;{$0}&#34;。',
        n_upper: '输入值太大，最大允许{$0}。', //注意：{$0}表示允许值，{$1}表示实际值
        n_lower: '输入值太小，最小允许{$0}。',
        nrange_from: '您输入的范围不合理。',
        nrange_to: '您输入的范围不合理。',
        n_useless_zero: '数字前面好像有多余的&#34;0&#34;。',
        d_format: '日期输入格式为&#34;YYYY-MM-DD&#34;。',
        d_upper: '日期太晚，最晚允许{$0}。',
        d_lower: '日期太早，最早允许{$0}。',
        daterange_from: '起始日期不能大于截止日期。',
        daterange_to: '截止日期不能小于起始日期。',
        daterange_larger_span: "时间跨度不得超过{$0}天。",
        text_longer: '最多允许{$0}个字。', //'{$1}字太多，最多允许{$0}字'
        text_shorter: '请至少输入{$0}个字。', //'{$1}字太少，最少允许{$0}字'
        bytetext_longer: '最多允许{$0}个字节。', //'{$1}字节太多，最多允许{$0}字节'
        bytetext_shorter: '请至少输入{$0}个字节。', //'{$1}字节太少，最少允许{$0}字节'
        richtext_longer: '最多允许{$0}个字。',
        richtext_shorter: '请至少输入{$0}个字。',
        _reconfirm: '两次输入不一致。',
        _time: '请检查您输入的时间格式。',
        _minute: '请检查您输入的时间格式。',
        _email: '请检查您输入的Email格式。',
        _mobilecode: '请检查您输入的手机号码。',
        _phone: '请检查您输入的电话号码。',
        _phonewithext: '请检查您输入的电话号码。',
        _phonezone: '请检查您输入的电话区号。',
        _phonecode: '请检查您输入的电话号码。',
        _phoneext: '请检查您输入的电话分机号码。',
        _zipcode: '请检查您输入的邮政编码。',
        _idnumber: '请检查您输入的身份证号码，目前只支持15位或者18位。',
        _bankcard: '请检查您输入的银行账号。',
        _cnname: '请检查您输入的姓名。',
        _vcode: '请检查您输入的验证码。',
        _imgfile: '请检查您选择的图片文件路径，只支持jpg、jpeg、png、gif、tif、bmp格式。',
        _regexp: '请检查您的输入。',
        _magic: '请检查您的输入。',
        _req_text: '请填写{$0}。',
        _req_select: '请选择{$0}。',
        _req_file: '请上传{$0}。',
        _logicrequired: '{$0}输入不完整.',
        _ssid: '请输入标准字符，如 Xiaomi.Luyouqi',
        _macaddr: 'MAC地址格式有误，如ab:cd:ef:11:22:33',
        _weppassword: '密码输入有误',
        _wifipassword: '不能包含中文',
        _ipaddr: 'IP地址由4个 0~255 之间的数字组成，数字之间用点区隔',
        _url: '必须是完整的URL,如 http://miwifi.com'
    };
</script>
<script src="/xuci/assets/js/jquery-1.8.3.js"></script>
<script src="/xuci/assets/js/qwrap.js"></script>
<script src="/xuci/assets/js/common.js"></script>
<script src="/xuci/assets/js/raphael.js"></script>
<script src="/xuci/assets/js/crypto-js/rollups/sha1.js"></script>
<script src="/xuci/assets/js/crypto-js/rollups/aes.js"></script>
<script src="/xuci/assets/js/valid.js"></script>
<script src="/xuci/assets/js/selectbeautify.js"></script>
<script src="/xuci/assets/js/jquery.dialog.js"></script>
<script src="/xuci/assets/js/template-web.js"></script>
<script>
    (function () {
        var G_FEATURES = $.parseJSON('{"netmode":{"elink":"1"},"hardware":{"disk":"0","usb":"1"},"wifi":{"wifimerge":"1","wifiguest":"1","wifi24":"1","wifi50":"1"},"apps":{"apptc":"0","qos":"1"},"apmode":{"lanapmode":"1","wifiapmode":"1"},"system":{"infileupload":"1","downloadlogs":"0","shutdown":"0","i18n":"0","task":"0"}}');
        window['G_FEATURES'] = G_FEATURES;
    }())
</script>

<script>
    // reboot
    var global_api_reboot = {
        url: '/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/api/xqsystem/reboot',
        param: {"client": "web"}
    };

    function reboot_window(needconfirm) {
        console.log(needconfirm);
        var reboot = function () {
            $.getJSON(global_api_reboot.url, global_api_reboot.param, function (rsp) {
                if (rsp.code !== 0) {
                    $.alert(rsp.msg).time(1.5 * 1000);
                } else {
                    var ip = rsp.lanIp[0].ip;
                    rebootWait({
                        lanIp: ip,
                        action: '重启路由器',
                        refresh: true
                    });
                }
            });
        };
        if (typeof( needconfirm ) !== "undefined" && needconfirm === false) {
            reboot();
            return;
        }
        $.confirm('确定重启路由器，重启将断开和灵铱路由器的连接。', function () {
            var dlg = this;
            reboot();
            dlg.close();
            return false;
        });
    }

    // shutdown
    function shutdown_window() {
        $.confirm('是否确定关闭路由器，操作将断开和灵铱路由器的连接。', function () {
            $.getJSON('/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/api/xqsystem/shutdown', {}, function (rsp) {
                if (rsp.code !== 0) {
                    $.alert(rsp.msg).time(1.5 * 1000);
                } else {
                    $.loadingDialog({
                        title: '关闭路由器',
                        content: '关机中，请等待路由器指示灯熄灭后再断开电源'
                    });
                }
            });
        });
    }

    //reset
    function reset_window(format) {

        var reset = (function (format) {
            var requestURL = '/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/api/xqsystem/reset',
                requestData = {
                    format: format ? 1 : 0
                },
                wait = function () {
                    rebootWait({
                        action: '恢复出厂设置',
                        refresh: true,
                        lanIp: '192.168.31.1'
                    });
                },
                clearCookies = function () {
                    var keys = document.cookie.match(/[^ =;]+(?=\=)/g);
                    if (keys) {
                        for (var i = keys.length; i--;) {
                            document.cookie = keys[i] + '=0;path=/;expires=' + new Date(0).toUTCString();
                        }
                    }
                };

            return function () {
                $.getJSON(requestURL, requestData, function (rsp) {
                    if (rsp.code !== 0) {
                        $.alert(rsp.msg).time(3 * 1000);
                    } else {
                        // clear cookies
                        clearCookies();
                        //block wait
                        wait();
                    }
                });
            }
        })(format);

        $.confirm('确定要恢复出厂设置让灵铱路由器回到初始状态？', function () {
            reset();
        });
    }
</script>
<script>

    var Encrypt = {
        key: 'a2ffa5c9be07488bbb04a3a47d3c5f6a',
        iv: '64175472480004614961023454661220',
        nonce: null,
        init: function () {
            var nonce = this.nonceCreat();
            this.nonce = nonce;
            return this.nonce;
        },
        nonceCreat: function () {
            var type = 0;
            var deviceId = '3c:f8:62:da:81:99';
            var time = Math.floor(new Date().getTime() / 1000);
            var random = Math.floor(Math.random() * 10000);
            return [type, deviceId, time, random].join('_');
        },
        oldPwd: function (pwd) {
            return CryptoJS.SHA1(this.nonce + CryptoJS.SHA1(pwd + this.key).toString()).toString();
        },
        newPwd: function (pwd, newpwd) {
            var key = CryptoJS.SHA1(pwd + this.key).toString();
            key = CryptoJS.enc.Hex.parse(key).toString();
            key = key.substr(0, 32);
            key = CryptoJS.enc.Hex.parse(key);
            var password = CryptoJS.SHA1(newpwd + this.key).toString();
            var iv = CryptoJS.enc.Hex.parse(this.iv);
            var aes = CryptoJS.AES.encrypt(
                password,
                key,
                {iv: iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7}
            ).toString();
            return aes;
        }
    };

    var pingRouter = function (on, off, ip) {
        var online = on || function () {
            },
            offline = off || function () {
            },
            host = ip || location.host,
            imgUrl = 'http://' + host + '/xiaoqiang/web/img/logo.png',
            time = 5000,
            timecounter = 0,
            img = null,
            wait = function () {
                console.log('pingRouter:wait');
                offline();
            },
            done = function () {
                console.log('pingRouter:done');
                window.clearInterval(timer);
                online();
            },
            loadImg = function (onload, onerror) {
                img = new Image();
                img.onload = onload;
                img.onerror = onerror;
                img.src = imgUrl + '?' + (+new Date());
            },
            timer = window.setInterval(function () {

                if ('onLine' in navigator) {
                    if (navigator.onLine) {
                        loadImg(
                            function () {
                                done();
                            }, function () {
                                wait();
                            }
                        );
                    } else {
                        wait();
                    }
                } else {
                    loadImg(function () {
                        done();
                    }, function () {
                        wait();
                    });
                }
            }, time);
    };

    var rebootWait = function (opt) {
        var action = opt.action,
            ip = opt.lanIp || window.location.host,
            refresh = opt.refresh || false,
            tStart = ( +new Date() ),
            tUse,
            dlgRebootWait = $.loadingDialog({
                title: '重启中...',
                content: '操作生效，等待设备重启...'
            }),
            online = function () {
                dlgRebootWait.content('操作生效,重启成功！');
                dlgRebootWait.time(3 * 1000);
                if (refresh) {
                    window.setTimeout('window.top.location.href="http://' + ip + '/";', 3000);
                }
            },
            offline = function () {
                tUse = Math.round(( ( +new Date() ) - tStart ) / 1000);
                if (tUse > 150) {
                    dlgRebootWait.content('自动连接路由器失败，请检查无线或者网线是否连接正确。');
                    return;
                }
                dlgRebootWait.content(action + ', 等待自动跳转... 用时{$time}秒'.tmpl({time: tUse}));
            };

        window.setTimeout(function () {
            pingRouter(online, offline, ip);
        }, 1000 * 60);
    };

    (function ($) {

        function formInit(container) {
            var clsInput = 'form-item form-item-input',
                clsEmpty = 'form-item form-item-empty',
                clsDisabled = 'form-item-disabled',
                clsError = 'form-item-err',
                clsPassword = 'form-item-pwd';

            container = container || 'body';
            $(container).find('.form-item input').each(function () {
                var me = this,
                    $me = $(me),
                    parent = $(me.parentNode.parentNode),
                    label = parent.find('.k'),
                    offsetX = $me.position().left;
                if (!( this.type == 'text' || this.type == 'password' )) {
                    return;
                }
                // some input do not need init
                if ($me.hasClass('no-init')) {
                    return;
                }
                if (me.value !== '') {
                    parent[0].className = clsInput;
                } else {
                    parent[0].className = clsEmpty;
                    if (offsetX > 0) {
                        label.css({'left': offsetX + 10});
                    }
                }
                if (me.disabled) {
                    parent.addClass(clsDisabled);
                }
                if ($me.attr('data-type') === 'password') {
                    parent.addClass(clsPassword);
                    parent.append('<i class="bt-showpwd bt-showpwd-off"></i>');
                }

                label.on('click', function (e) {
                    try {
                        me.focus();
                    } catch (ex) {
                    }
                });

            });
            var focusHandler = function () {
                if (!( this.type == 'text' || this.type == 'password' )) {
                    return;
                }
                var me = $(this),
                    parent = $(this.parentNode.parentNode),
                    label = parent.find('.k'),
                    t = parent.find('.t'),
                    classname;
                if (me.hasClass('no-init')) {
                    return;
                }
                if (parent.hasClass(clsPassword)) {
                    classname = clsInput + ' ' + clsPassword;
                } else {
                    classname = clsInput;
                }
                if (parent.hasClass(clsError)) {
                    t.hide();
                }
                label.css({'left': 'auto'});
                label.hide();
                parent[0].className = classname;
            };
            var blurHandler = function () {
                var me = this,
                    $me = $(me),
                    parent = $(me.parentNode.parentNode),
                    classname,
                    label = parent.find('.k'),
                    offsetX = $me.position().left;
                if (!( this.type == 'text' || this.type == 'password' )) {
                    return;
                }
                if ($(this).hasClass('no-init')) {
                    return;
                }
                label.show();
                if (me.value == '') {
                    if (parent.hasClass(clsPassword)) {
                        classname = clsEmpty + ' ' + clsPassword;
                    } else {
                        classname = clsEmpty;
                    }
                    if (offsetX > 0) {
                        label.css({'left': offsetX + 10});
                    } else {
                        label.css({'left': 12});
                    }
                    parent[0].className = classname;
                }
            };
            var addInputEvent = function () {
                $(container).find('.form-item input')
                    .on('focus', focusHandler)
                    .on('blur', blurHandler);
            };

            var delInputEvent = function () {
                $(container).find('.form-item input').off('focus', focusHandler);
                $(container).find('.form-item input').off('blur', blurHandler);
            };
            // del password event
            $('body').undelegate('.bt-showpwd', 'click');
            $('body').delegate('.bt-showpwd', 'click', function (e) {
                console.log('showpwd');
                var me = this,
                    meclass = 'bt-showpwd',
                    formItem = $(this).closest('.form-item'),
                    input = formItem.find('input'),
                    inputValue = input.val(),
                    inputWrap = formItem.find('.v'),
                    newinput = '',
                    inputHTML = inputWrap.html();

                if (input.attr('type') == 'password') {
                    newinput = inputHTML.replace(/type\s*=\s*('|")?password('|")?/ig, 'type="text"');
                    inputWrap.html(newinput).find('input')[0].value = inputValue;
                    me.className = meclass + ' bt-showpwd-on';
                } else {
                    newinput = inputHTML.replace(/type\s*=\s*('|")?text('|")?/ig, 'type="password"');
                    inputWrap.html(newinput).find('input')[0].value = inputValue;
                    me.className = meclass + ' bt-showpwd-off';
                }

                setTimeout(function () {
                    delInputEvent();
                    addInputEvent();
                }, 0);
            });

            addInputEvent();
        }

        $.formInit = formInit;

    })(jQuery);

    /**
     * byte format
     */
    function byteFormat(number, precision, isarray) {
        var val,
            label,
            ret;
        precision = precision || 100,
            isarray = isarray || false;
        if (number > 1024 * 1024 * 1024) {
            val = Math.floor(number / 1024 / 1024 / 1024 * precision) / precision;
            label = 'GB';
        } else if (number > 1024 * 1024 && number < 1024 * 1024 * 1024) {
            val = Math.floor(number / 1024 / 1024 * precision) / precision;
            label = 'MB';
        } else {
            val = Math.floor(number / 1024 * precision) / precision;
            label = 'KB';
        }

        if (isarray) {
            ret = [val, label];
        } else {
            ret = val + label;
        }

        return ret;
    }


    function secondToHour(time) {
        var pint = function (num) {
                return parseInt(num, 10);
            },
            hour = pint(time / 3600.0),
            minute = pint((parseFloat(time / 3600.0) - hour) * 60),
            second = pint(time) - hour * 3600 - minute * 60,
            format = hour + '小时' + minute + '分' + second + '秒';
        return format;
    }

    function secondToDate(second) {
        var time = parseFloat(second),
            pint = function (num) {
                return parseInt(num, 10);
            },
            day;
        if (time !== null && time !== "") {
            if (time > 60 && time < 60 * 60) {
                time = pint(time / 60.0) + '分' + pint((parseFloat(time / 60.0) - pint(time / 60.0, 10)) * 60) + '秒';
            }
            else if (time >= 60 * 60 && time < 60 * 60 * 24) {
                time = secondToHour(time);
            } else if (time >= 24 * 60 * 60) {
                day = pint(time / (3600.0 * 24));
                time = time - (day * 3600 * 24);
                time = day + '天 ' + secondToHour(time);
            }
            else {
                time = pint(time) + '秒';
            }
        }
        return time;
    }

    (function ($) {
        function pint(num) {
            return parseInt(num, 10);
        }

        function secondToHour(time) {
            var hour = pint(time / 3600.0),
                minute = pint((parseFloat(time / 3600.0) - hour) * 60),
                second = pint(time) - hour * 3600 - minute * 60,
                format = hour + '小时' + minute + '分' + second + '秒';
            return format;
        }

        function secondToDate(second) {
            var time = parseFloat(second),
                day;
            if (time !== null && time !== "") {
                if (time > 60 && time < 60 * 60) {
                    time = pint(time / 60.0) + '分' + pint((parseFloat(time / 60.0) - pint(time / 60.0, 10)) * 60) + '秒';
                }
                else if (time >= 60 * 60 && time < 60 * 60 * 24) {
                    time = secondToHour(time);
                } else if (time >= 24 * 60 * 60) {
                    day = pint(time / (3600.0 * 24));
                    time = time - (day * 3600 * 24);
                    time = day + '天' + secondToHour(time);
                }
                else {
                    time = pint(time) + '秒';
                }
            }
            return time;
        }

        function secondToDate2(second) {
            var time = parseFloat(second),
                num = 0,
                unit = '天';
            console.log(second, time);
            if (!isNaN(time)) {
                if (time > 60 && time < 60 * 60) {
                    num = Math.floor(time / 60.0);
                    unit = '分钟';
                } else if (time >= 60 * 60 && time < 60 * 60 * 24) {
                    num = Math.floor(time / 3600.0);
                    unit = '小时'
                } else if (time >= 24 * 60 * 60) {
                    num = Math.floor(time / (3600.0 * 24));
                    unit = '天';
                } else {
                    num = Math.floor(time);
                    unit = '秒';
                }
            }
            return {
                num: num,
                unit: unit
            };
        }

        $.secondToHour = secondToHour;
        $.secondToDate = secondToDate;
        $.secondToDate2 = secondToDate2;
    })(jQuery);


    $(document).ajaxSuccess(function (event, xhr, settings) {
        var rsp = xhr.responseText;
        rsp = $.parseJSON(rsp);
        // console.log(event, xhr, settings);
        var ignore = [
            'api\/xqsystem\/login',
            'api\/xqsystem\/upgrade_rom'
        ];
        for (var i = 0; i < ignore.length; i++) {
            var ignoreTest = new RegExp(ignore[i]);
            // console.log( ignoreTest );
            if (ignoreTest.test(settings.url)) {
                return;
            }
        }
        if (rsp.code === 401 || rsp.code === 403) {
            document.location.href = 'http:///' + location.host;
        }
    });

    $.sub('wait', function (evt, data) {
        var selector = data.id;
        if (!$.waitStatus) {
            $.waitStatus = {};
        }
        $.waitStatus[selector] = $(selector).text();
        $(selector).addClass('btn-primary-disabled').prop('disabled', true).find('span').text('处理中...');
    });

    $.sub('done', function (evt, data) {
        var selector = data.id,
            text = $.waitStatus[selector];
        $(selector).removeClass('btn-primary-disabled').prop('disabled', false).find('span').text(text);
    });

    $.sub('loading:start', function () {
        var isLoading = $('html').hasClass('isloading');
        if (isLoading) {
            return;
        }
        var tplMask = '<div id="panel-loading-mask" class="panel-mask" style="position:fixed;left:0;top:0;style:none;"></div>',
            tplLoading = ''
                + '<div id="panel-loading" class="panel-loading" style="style:none;">'
                + '<img src="/xuci/assets/img/loading2.gif"/*tpa=http://192.168.31.1/img/loading2.gif*/>'
                + '</div>',
            $mask = $(tplMask),
            $loading = $(tplLoading),
            zIndex = 10000;
        $mask.css({
            'z-index': zIndex,
            width: $(window).width() + 'px',
            height: $(window).height() + 'px'
        });
        $loading.css({'z-index': zIndex + 1});
        $mask.appendTo(document.body).show();
        $loading.appendTo(document.body).show();
        $('html').addClass('isloading');
    });

    $.sub('loading:stop', function () {
        $('html').removeClass('isloading');
        $('#panel-loading, #panel-loading-mask').remove();
    });

    // dialog block loading
    (function ($) {
        $.loadingDialog = function (config) {
            var mix = ObjectH.mix,
                _config = config || {
                    title: '',
                    content: ''
                },
                conf = mix(_config, {
                    width: 390,
                    padding: '25px 30px',
                    title: config.title,
                    content: '<p style="padding-bottom:30px;">{$content}</p><div class="loading-bar"></div>'.tmpl({content: config.content}),
                    cancel: false
                }, true),
                dialog = $.dialog(conf);

            var oldcontent = dialog.content;
            dialog.content = function (cont) {
                var _cont = '<p style="padding-bottom:30px;">{$content}</p><div class="loading-bar"></div>'.tmpl({content: cont});
                return oldcontent.call(dialog, _cont);
            };
            return dialog;
        }
    })(jQuery);

    // dialog alert
    (function ($) {
        $.alert = function (content, ok) {
            ok = ok || function () {
            };
            return $.dialog({
                width: 390,
                padding: '25px 30px',
                title: '提示信息',
                content: content,
                ok: ok,
                cancel: false
            });
        }
    })(jQuery);

    // dialog confirm
    (function ($) {
        $.confirm = function (content, ok, cancel) {
            var _cancel = cancel || function () {
            };
            return $.dialog({
                width: 390,
                padding: '25px 30px',
                title: '确认信息',
                content: content,
                ok: ok,
                cancel: _cancel,
                lock: true
            });
        }
    })(jQuery);

    // wechat code dialog
    $(function () {
        $('#wechatcode').click(function (e) {
            e.preventDefault();
            var $this = $(this),
                href = $this.attr('href');
            $.dialog({
                title: '官方微信',
                content: '<img width="200" src="' + href + '">',
                width: 250,
                lock: true
            });
        });
    });


    // set sys language
    (function ($) {
        $.i18nSet = function (el) {
            var $lan = $(el),
                apiGetLan = '/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/api/xqsystem/get_languages',
                apiSetlan = '/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/api/xqsystem/set_language',
                dtd = $.Deferred();

            $.get(apiGetLan, function (rsp) {
                var rsp = $.parseJSON(rsp);
                var selectContent = [];
                if (rsp.code == 0) {
                    for (var i = 0; i < rsp.list.length; i++) {
                        var item = rsp.list[i],
                            selected = item.lang == rsp.lang ? 'selected' : '',
                            option = '<option value="' + item.lang + '" ' + selected + '>' + item['name'] + '</option>';
                        // clear old conf en item
                        // if ( item.lang != 'en') {
                        selectContent.push(option);
                        // }
                    }
                    ;
                    $lan.html(selectContent.join(''));
                    dtd.resolve();
                }
            });

            $lan.on('change', function (e) {
                var el = this,
                    val = $(this).val();
                $.pub('loading:start');
                $.post(apiSetlan, {language: val}, function (rsp) {
                    var rsp = $.parseJSON(rsp);
                    if (rsp.code == 0) {
                        location.reload(1);
                    } else {
                        $.alert(rsp.msg);
                    }
                    $.pub('loading:stop');
                });
            });

            return dtd.promise();
        };
    }(jQuery));


    // global event
    (function ($) {
        var dlgReboot,
            dlgShutdown,
            dlgRouterName;

        function getNotice() {
            $.getJSON('/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/api/misystem/messages', function (rsp) {
                if (rsp.code == 0) {
                    var classname;
                    if (rsp.count > 0) {
                        classname = 'ico-notice-new';
                    } else {
                        classname = 'ico-notice';
                    }
                    $('#sysnotice')[0].className = classname;
                    var msgMap = {
                        '1': '<p>检测到最新版本为{$version}，<a href="upgrade.htm"/*tpa=http://192.168.31.1/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/web/setting/upgrade*/>点击此处立即升级</a>。</p>',
                        '3': '<p>5G Wi-Fi启动失败，<a target="_blank" href="http://www.mi.com/service/contact/">请联系灵铱客服解决</a></p>',
                        '4': '<p>检测到与上级路由器存在IP冲突，建议切换到<a href="wan.htm#netmode"/*tpa=http://192.168.31.1/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/web/setting/wan#netmode*/>有线中继模式</a>或者<a href="#" id="ipconflict" data-ip="{$ip}">避让IP冲突</p>'
                    };
                    var msgHTML = [];
                    for (var i = rsp.messages.length - 1; i >= 0; i--) {
                        msgHTML.push(msgMap[rsp.messages[i].type].tmpl(rsp.messages[i].data));
                    }
                    ;
                    $('#noticebar .content').html(msgHTML.join(''));

                    if (rsp.count > 0) {
                        $('#sysnotice').trigger('click');
                    }
                }
            });
        }

        function reNameHandler(e) {
            e.preventDefault();
            $.getJSON('/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/api/misystem/router_name')
                .done(function (rsp) {
                    if (rsp.code == 0) {
                        var html = StringH.tmpl($('#tplrename').html(), {
                            locale: StringH.encode4HtmlValue(rsp.locale),
                            name: StringH.encode4HtmlValue(rsp.name)
                        });
                        dlgRouterName = $.dialog({
                            width: 390,
                            title: '修改路由器名称',
                            content: html,
                            lock: true
                        });
                        setTimeout(function () {
                            $.formInit('.mod-rename-dlg');
                            $.selectBeautify({container: '.mod-rename-dlg'});
                        }, 100);
                    }
                });
        }

        function downloadClientHandler(e) {
            e.preventDefault();
            $.dialog({
                width: 390,
                title: '下载客户端',
                content: $('#tpldownloadclient').html(),
                lock: true
            });
            setTimeout(function () {
                $('.onlineimg').each(function () {
                    var img = new Image();
                    var el = this;
                    var remote = el.src;
                    var local = $(el).attr('src-local');
                    img.onerror = function () {
                        el.src = local;
                    }
                    img.src = remote;
                });
            }, 100);
        }

        function rebootHandler(e) {
            e.preventDefault();
            dlgReboot = $.dialog({
                width: 390,
                title: '重启路由器',
                content: $('#tplreboot').html(),
                lock: true
            });
        }

        function shutdownHandler(e) {
            e.preventDefault();
            dlgShutdown = $.dialog({
                width: 390,
                title: '路由器关机',
                content: $('#tplshutdown').html(),
                lock: true
            });
        }

        function noticeHandler(e) {
            e.preventDefault();
            var that = this,
                $this = $(this),
                pos = $('#userbar').position(),
                right,
                wt = 1160,
                wwt = $(window).width(),
                $arrow = $('#noticebar .ico-arrow');
            if ($this.hasClass('ico-notice-new')) {
                // right = wt - pos.left - 20;
                $arrow.css({'right': '10px'});
                $('#noticebar').css({'right': (wwt - wt) / 2});
                $('#noticebar').toggle();
            }
            $('#maskMenu').height($(window).height());
            $('#maskMenu').show();
        }

        function sysmenuHandler(e) {
            e.preventDefault();
            var that = this,
                $this = $(this);
            if ($this.hasClass('s-dropdown')) {
                var ww = $(window).width();
                // var rt = (ww - 1160) / 2;
                var lt = $this.offset().left + $this.outerWidth() - $('#dropmenu').width();
                $('#dropmenu').css({left: lt});
                $('#dropmenu').show();
                that.className = 'name s-dropup';
            } else {
                $('#dropmenu').hide();
                that.className = 'name s-dropdown';
            }
            $('#maskMenu').height($(window).height());
            $('#maskMenu').show();
        }

        function maskHandler(e) {
            e.preventDefault();
            $('#noticebar').hide();
            $('#dropmenu').hide();
            $('#maskMenu').hide();
            $('#sysmenu')[0].className = 'name s-dropdown';
        }

        $(function () {
            // notice
            $('#sysnotice').click(noticeHandler);
            // user dropmenu
            $('#sysmenu').click(sysmenuHandler);
            // space click
            $('#maskMenu').click(maskHandler);
            // rename
            $('body').delegate('#toRename', 'click', reNameHandler);
            // toDownloadClient
            $('body').delegate('#toDownloadClient', 'click', downloadClientHandler);
            // toReboot
            $('body').delegate('#toReboot', 'click', rebootHandler);
            // toShutdown
            $('body').delegate('#toShutdown', 'click', shutdownHandler);

            $('body').delegate('#shutdownAction', 'click', function (e) {
                e.preventDefault();
                dlgShutdown.close();
                shutdown_window();
            });

            $('body').delegate('#rebootAction', 'click', function (e) {
                e.preventDefault();
                dlgReboot.close();
                reboot_window();
            });

            $('body').delegate('#routerNameEdit', 'submit', function (e) {
                e.preventDefault();
                var validator = Valid.checkAll(this);
                var routername = $('#routername').val();
                var locale = $('#locale').val();
                if (validator) {
                    $.getJSON('/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/api/misystem/set_router_name', {
                        name: routername,
                        locale: locale
                    }).done(function (rsp) {
                        if (rsp.code == 0) {
                            location.reload(1);
                        } else {
                            $.alert(rsp.msg)
                        }
                    });
                }
            });

            $('body').delegate('#ipconflict', 'click', function (e) {
                e.preventDefault();
                var api = '/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/api/misystem/r_ip_conflict',
                    ip = $(this).attr('data-ip');
                $.dialog({
                    title: '避让IP冲突',
                    content: '执行此操作，局域网IP将会变更为' + ip + '<br>' + '该过程无线网络会重启，将出现短暂掉线。',
                    lock: true,
                    ok: function () {
                        $.post(api, function (rsp) {
                            rsp = $.parseJSON(rsp);
                            if (rsp.code !== 0) {
                                alert(rsp.msg);
                            }
                        });
                    },
                    cancel: function () {
                    }
                });
            });

            // user logined and has global header get notice
            if (typeof(GLOBALHEADER) !== 'undefined' && GLOBALHEADER === true) {
//                getNotice();
            }
        });
    })(jQuery);
</script>
<script src="/xuci/assets/js/miwifi-monitor.js" tppabs="http://192.168.31.1/js/miwifi-monitor.js"></script>
<script>
    // 流量统计
    (function () {
        var IS_MOBILE = (
            navigator.userAgent.match(/Android/i)
            || navigator.userAgent.match(/webOS/i)
            || navigator.userAgent.match(/iPhone/i)
            || navigator.userAgent.match(/iPad/i)
            || navigator.userAgent.match(/iPod/i)
            || navigator.userAgent.match(/BlackBerry/i)
            || navigator.userAgent.match(/Windows Phone/i)
        );
        var PAGEURL = document.URL.split('/web/')[1];
        var PAGE_MONITOR_CONF = {
            deviceId: '2c401005-a6e3-707d-f56e-74774d176333',
            isMobile: IS_MOBILE ? IS_MOBILE[0] : 'pc',
            url: PAGEURL ? '/web/' + PAGEURL : '/web/login',
            romVersion: '2.25.122.htm'/*tpa=http://192.168.31.1/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/web/setting/2.25.122*/,
            romChannel: 'stable',
            hardwareVersion: 'R3G'
        };
        MIWIFI_MONITOR.setProject('MIWIFIWEB');
        MIWIFI_MONITOR.log(PAGE_MONITOR_CONF, 'track');
    }());
</script>

<script type="text/tmpl" id="tplbsdWrap">
    <form class="form form-horizontal" id="wifisetbsd">
        <div id="wifisetbsdtop">
        </div>
        <p class="bsd-ground">2.4G 选项</p>
        <div id="wifiset24" class="form">
        </div>
        <p class="bsd-ground">5G 选项</p>
        <div id="wifiset50" class="form">
        </div>
    </form>
</script>
<script type="text/tmpl" id="tplWifiBsdTop">
    <div class="item">
        <span class="k">开关</span>
        <span class="v">
            <label><input type="radio" name="on" value="1"{if ($status == 1)} checked{/if}> <span>开启</span></label>
            <label><input type="radio" name="on" value="0"{if ($status == 0)} checked{/if}> <span>关闭</span></label>
        </span>
    </div>
    <div class="form-item">
        <label class="k">名称</label>
        <span class="v"><input type="text" name="ssid" value="{$ssid}" class="ipt-text" autocomplete="off" datatype="ssid" maxLength="31" minLength="1" reqMsg="Wi-Fi名称" /></span>
        <em class="t"></em>
    </div>
    <div class="form-item">
        <label for="hidessid{$wifitype}"> <input type="checkbox" id="hidessid{$wifitype}" name="hidden" value="1" {if ($hidden == 1)}checked{/if}> <span>隐藏网络不被发现</span></label>
    </div>
    <div class="form-item-select">
        <label class="k">加密方式</label>
        <span class="v">
            <select name="encryption" class="beautify encryption" >
                <option value="psk2"{if ($encryption == "psk2")} selected{/if}>强加密(WPA2个人版)</option>
                <option value="mixed-psk"{if ($encryption == "mixed-psk")} selected{/if}>混合加密(WPA/WPA2个人版)</option>
                <option value="none"{if ($encryption == "none")} selected{/if}>无加密(允许所有人连接)</option>
            </select>
        </span>
        <em class="t"></em>
    </div>
    <div class="form-item" {if($encryption == "none")} style="display:none;"{/if}>
        <label class="k">密码</label>
        <span class="v">
            <input type="password" data-type="password" name="pwd" value="{$password}" class="ipt-text" autocomplete="off" datatype="wifipassword" minLength="8" maxLength="63" reqMsg="Wi-Fi密码" />
        </span>
        <em class="t"></em>
    </div>
















































</script>
<script type="text/tmpl" id="tplWifiBsd">
    {if ($wifitype == 2)}
    <input type="hidden" value="{$wifiIndex}" name="wifiIndex">
    <div class="item">
        <span class="k">开关</span>
        <span class="v">
        {if ($wifitype == 2)}
            <label><input type="radio" name="on" value="1"{if ($enabled == 1 && $status == 1)} checked{/if}> <span>开启</span></label>
            <label><input type="radio" name="on" value="0"{if ($enabled == 0 || $status == 0)} checked{/if}> <span>关闭</span></label>
        {else}
            <label><input type="radio" name="on" value="1"{if ($status == 1)} checked{/if}> <span>开启</span></label>
            <label><input type="radio" name="on" value="0"{if ($status == 0)} checked{/if}> <span>关闭</span></label>
        {/if}
        </span>
    </div>
    <div class="form-item">
        <label class="k">名称</label>
        <span class="v"><input type="text" name="ssid" value="{$ssid}" class="ipt-text" autocomplete="off" datatype="ssid" maxLength="31" minLength="1" reqMsg="Wi-Fi名称" /></span>
        <em class="t"></em>
    </div>
    <div class="form-item-select">
        <label class="k">加密方式</label>
        <span class="v">
            <select name="encryption" class="beautify encryption">
                <option value="psk2"{if ($encryption == "psk2")} selected{/if}>强加密(WPA2个人版)</option>
                <option value="mixed-psk"{if ($encryption == "mixed-psk")} selected{/if}>混合加密(WPA/WPA2个人版)</option>
                <option value="none"{if ($encryption == "none")} selected{/if}>无加密(允许所有人连接)</option>
            </select>
        </span>
        <em class="t"></em>
    </div>
    <div class="form-item" {if($encryption == "none")} style="display:none;"{/if}>
        <label class="k">密码</label>
        <span class="v">
            <input type="password" data-type="password" name="pwd" value="{$password}" class="ipt-text" autocomplete="off" datatype="wifipassword" minLength="8" maxLength="63" reqMsg="Wi-Fi密码" />
        </span>
        <em class="t"></em>
    </div>
    {/if}

    {if ($wifitype != 2)}
    <div class="form-item-select">
        <label class="k">无线信道</label>
        <span class="v">
        <select name="channel" class="beautify channel" data-id="{$wifitype}">
            {for(var i=0, len=$channels.length; i<len; i++)}
                <option value="{$channels[i]['c']}" {if ($channel==$channels[i]['c'])}selected{/if}>
                {if ($channels[i]['c']==0)}自动
                    {if ($channelInfo["channel"] != "0")}
                        ({$channelInfo["channel"]})
                    {/if}
                {else}
                    {$channels[i]['c']}
                {/if}
                </option>
            {/for}
        </select>
        </span>
        <em class="t"></em>
    </div>
    <div class="form-item-select itemBandwidth" {if ($channel == "0")}style="display:none;"{/if}>
        <label class="k">频段带宽</label>
        <span class="v">
            {if ($channel == "0")}
            <select name="bandwidth" class="beautify" id="bandwidth" >
                <option value="0">自动</option>
            </select>
            {else}
            <select name="bandwidth" class="beautify" >
                <option value="0" {if ($bandwidth  == "0")}selected="selected"{/if}>自动</option>
                {for(var i=0, len=$channelInfo["bandList"].length; i<len; i++)}
                    <option value="{$channelInfo["bandList"][i]}" {if ($channelInfo["bandList"][i] == $bandwidth)}selected="selected"{/if}>{$channelInfo["bandList"][i]}M</option>
                {/for}
            </select>
            {/if}
        </span>
        <em class="t"></em>
    </div>
    <div class="form-item-select">
        <label class="k">信号强度</label>
        <span class="v">
            <select name="txpwr" class="beautify txpwr">
                <option value="max"{if ($txpwr == "max")} selected{/if}>穿墙</option>
                <option value="mid"{if ($txpwr == "mid")} selected{/if}>标准</option>
                <option value="min"{if ($txpwr == "min")} selected{/if}>节能</option>
            </select>
        </span>
        <em class="t"></em>
    </div>
    {/if}
    {if ($wifitype != 0)}
    <div class="form-contral">
        <button type="submit" class="btn btn-primary btn-l hidden"><span>保存</span></button>
    </div>
    {/if}
















































</script>
<script type="text/tmpl" id="tplWifi">
    <input type="hidden" value="{$wifiIndex}" name="wifiIndex">
    <div class="item">
        <span class="k">开关</span>
        <span class="v">
        {if ($wifitype == 2)}
            <label><input type="radio" name="on" value="1"{if ($enabled == 1 && $status == 1)} checked{/if}> <span>开启</span></label>
            <label><input type="radio" name="on" value="0"{if ($enabled == 0 || $status == 0)} checked{/if}> <span>关闭</span></label>
        {else}
            <label><input type="radio" name="on" value="1"{if ($status == 1)} checked{/if}> <span>开启</span></label>
            <label><input type="radio" name="on" value="0"{if ($status == 0)} checked{/if}> <span>关闭</span></label>
        {/if}
        </span>
    </div>
    <div class="form-item">
        <label class="k">名称</label>
        <span class="v"><input type="text" name="ssid" value="{$ssid}" class="ipt-text" autocomplete="off" datatype="ssid" maxLength="31" minLength="1" reqMsg="Wi-Fi名称" /></span>
        <em class="t"></em>
    </div>
    {if ($wifitype != 2)}
    <div class="form-item">
        <label for="hidessid{$wifitype}"> <input type="checkbox" id="hidessid{$wifitype}" name="hidden" value="1" {if ($hidden == 1)}checked{/if}> <span>隐藏网络不被发现</span></label>
    </div>
    {/if}
    <div class="form-item-select">
        <label class="k">加密方式</label>
        <span class="v">
            <select name="encryption" class="beautify encryption" >
                <option value="psk2"{if ($encryption == "psk2")} selected{/if}>强加密(WPA2个人版)</option>
                <option value="mixed-psk"{if ($encryption == "mixed-psk")} selected{/if}>混合加密(WPA/WPA2个人版)</option>
                <option value="none"{if ($encryption == "none")} selected{/if}>无加密(允许所有人连接)</option>
            </select>
        </span>
        <em class="t"></em>
    </div>
    <div class="form-item" {if($encryption == "none")} style="display:none;"{/if}>
        <label class="k">密码</label>
        <span class="v">
            <input type="password" data-type="password" name="pwd" value="{$password}" class="ipt-text" autocomplete="off" datatype="wifipassword" minLength="8" maxLength="63" reqMsg="Wi-Fi密码" />
        </span>
        <em class="t"></em>
    </div>
    {if ($wifitype != 2)}
    <div class="form-item-select">
        <label class="k">无线信道</label>
        <span class="v">
        <select name="channel" class="beautify channel" data-id="{$wifitype}">
            {for(var i=0, len=$channels.length; i<len; i++)}
                <option value="{$channels[i]['c']}" {if ($channel==$channels[i]['c'])}selected{/if}>
                {if ($channels[i]['c']==0)}自动
                    {if ($channelInfo["channel"] != "0")}
                        ({$channelInfo["channel"]})
                    {/if}
                {else}
                    {$channels[i]['c']}
                {/if}
                </option>
            {/for}
        </select>
        </span>
        <em class="t"></em>
    </div>
    <div class="form-item-select itemBandwidth" {if ($channel == "0")}style="display:none;"{/if}>
        <label class="k">频段带宽</label>
        <span class="v">
            {if ($channel == "0")}
            <select name="bandwidth" class="beautify" id="bandwidth">
                <option value="0">自动</option>
            </select>
            {else}
            <select name="bandwidth" class="beautify" >
                <option value="0" {if ("0" == $bandwidth)}selected="selected"{/if}>自动</option>
                {for(var i=0, len=$channelInfo["bandList"].length; i<len; i++)}
                    <option value="{$channelInfo["bandList"][i]}" {if ($channelInfo["bandList"][i] == $bandwidth)}selected="selected"{/if}>{$channelInfo["bandList"][i]}M</option>
                {/for}
            </select>
            {/if}
        </span>
        <em class="t"></em>
    </div>
    <div class="form-item-select">
        <label class="k">信号强度</label>
        <span class="v">
            <select name="txpwr" class="beautify txpwr" >
                <option value="max"{if ($txpwr == "max")} selected{/if}>穿墙</option>
                <option value="mid"{if ($txpwr == "mid")} selected{/if}>标准</option>
                <option value="min"{if ($txpwr == "min")} selected{/if}>节能</option>
            </select>
        </span>
        <em class="t"></em>
    </div>
    {/if}
    <div class="form-contral">
        <button type="submit" class="btn btn-primary btn-l hidden"><span>保存</span></button>
    </div>
















































</script>

<script>
    (function () {
        var global = {};
        var generateMixed = function (n) {
            var res = "";
            var chars = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
            for (var i = 0; i < n; i++) {
                var id = Math.ceil(Math.random() * 35);
                res += chars[id];
            }
            return res;
        }

        function onControlFocus() {
            $(this).parents('form').find('.btn-primary').removeClass('hidden');
        }

        $.sub('wifi:init', function (evt, data) {
            global.wifi = {
                configs: [],
                pddk: {
                    '1': '[{"c":"0","b":["20","40"]},{"c":"1","b":["20","40"]},{"c":"2","b":["20","40"]},{"c":"3","b":["20","40"]},{"c":"4","b":["20","40"]},{"c":"5","b":["20","40"]},{"c":"6","b":["20","40"]},{"c":"7","b":["20","40"]},{"c":"8","b":["20","40"]},{"c":"9","b":["20","40"]},{"c":"10","b":["20","40"]},{"c":"11","b":["20","40"]},{"c":"12","b":["20","40"]},{"c":"13","b":["20","40"]}]',
                    '2': '[{"c":"0","b":["20","40"]},{"c":"36","b":["20","40","80"]},{"c":"40","b":["20","40","80"]},{"c":"44","b":["20","40","80"]},{"c":"48","b":["20","40","80"]},{"c":"52","b":["20","40","80"]},{"c":"56","b":["20","40","80"]},{"c":"60","b":["20","40","80"]},{"c":"64","b":["20","40","80"]},{"c":"149","b":["20","40","80"]},{"c":"153","b":["20","40","80"]},{"c":"157","b":["20","40","80"]},{"c":"161","b":["20","40","80"]},{"c":"165","b":["20"]}]'
                }
            };

            // get wifi and rander html
            var containers = ['wifiset24', 'wifiset50', 'wifisetguest'],
                tpl = $('#tplWifi').html();
            $.getJSON('/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/api/xqnetwork/wifi_detail_all')
                .done(function (rsp) {
                    if (rsp.code == 0) {
                        if (rsp.bsd == 1) {
                            $('#bsdswitch')
                                .removeClass('btn-switch-off')
                                .addClass('btn-switch-on')
                                .attr('data-on', '1');
                            $('.mod-wifi24 .hd h3').text('Wi-Fi');
                            $('.mod-wifi24 .bd.htm'/*tpa=http://192.168.31.1/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/web/setting/.mod-wifi24 .bd*/).html($('#tplbsdWrap').html());
                            $('.mod-wifi50').remove();
                            $('#wifisetbsd').delegate('input[type=text], input[type=checkbox], input[type=radio]', 'click', onControlFocus)
                                .delegate('.ipt-text', 'click', onControlFocus);
                            tpl = $('#tplWifiBsd').html();
                        }
                        var wifiinfo = rsp.info;
                        var haswifi50 = $('#wifiset50').length > 0 ? true : false;
                        for (var i = 0, len = wifiinfo.length; i < len; i++) {
                            var id = containers[i];
                            var container;
                            if (!haswifi50 && i == 1) {
                                container = $(document.getElementById('wifisetguest'));
                            } else {
                                if (haswifi50 && i == 1) {
                                    if (wifiinfo[i].txbf == 0 || wifiinfo[i].txbf == "0") {
                                        $('#txbfswitch')
                                            .removeClass('btn-switch-on')
                                            .addClass('btn-switch-off')
                                            .attr('data-on', '0');
                                    }

                                }
                                container = $(document.getElementById(id));
                            }
                            var wifiitem = wifiinfo[i];
                            var password = wifiitem.password;
                            var encryption = wifiitem.encryption;
                            if (encryption == 'none') {
                                password = '';
                            }
                            var tplData = {
                                wifitype: (!haswifi50 && i == 1) ? i + 1 : i,
                                wifiIndex: (!haswifi50 && i == 1) ? i + 2 : i + 1,
                                status: wifiitem.status,
                                ssid: StringH.encode4HtmlValue(wifiitem.ssid),
                                password: StringH.encode4HtmlValue(password),
                                encryption: wifiitem.encryption,
                                channels: $.parseJSON(global.wifi.pddk[i + 1]),
                                channel: wifiitem.channel,
                                bandwidth: wifiitem.bandwidth,
                                channelInfo: wifiitem.channelInfo,
                                hidden: wifiitem.hidden,
                                txpwr: wifiitem.txpwr,
                                txbf: wifiitem.txbf,
                                enabled: wifiitem.enabled
                            };
                            if (i == 0 && rsp.bsd == 1) {
                                $('#wifisetbsdtop').html($('#tplWifiBsdTop').html().tmpl(tplData));
                            }
                            container.html(tpl.tmpl(tplData));
                            global.wifi.configs[i + 1] = tplData;
                        }
                    }
                    setTimeout(function () {
                        $.selectBeautify();
                        $.formInit();
                        $.pub('wifi:bindEventEncryption');
                        $.pub('wifi:bindEventChannel');
                    }, 100);
                });
        });

        $.sub('wifi:bindEventEncryption', function () {
            $('.encryption').on('change', function (e) {
                var val = $(this).val(),
                    root = $(this).parents('form'),
                    pwd = root.find('.form-item-pwd'),
                    tips = $(this.parentNode).next('.t');
                if (val === 'none') {
                    pwd.hide();
                } else {
                    pwd.show();
                }
                if (val === 'psk2') {
                    tips.html('仅支持WPA加密方式的设备将无法连接').show();
                } else {
                    tips.html('');
                }
            });
        });

        $.sub('wifi:bindEventChannel', function () {
            $('.channel').on('change', function (e) {
                var channelVal = this.value,
                    that = this,
                    id = $(this).attr('data-id'),
                    id = parseInt(id, 10) + 1,
                    root = $(this).parents('form'),
                    pwd = root.find('.form-item-pwd'),
                    $bandwidth = $(this).closest('.form').find('[name=bandwidth]'),
                    $itemBandwidth = $(this).closest('.form').find('.itemBandwidth'),
                    tips = $(this.parentNode).next('.t'),
                    pddk,
                    item = '<option value="0">自动</option>',
                    bdlist = [];
                var wifiname = $(this).closest('.form').attr('id');

                if (channelVal === '0') {
                    $itemBandwidth.hide();
                    return;
                }

                pddk = $.parseJSON(global.wifi.pddk[id]);
                for (var i = 0; i < pddk.length; i++) {
                    var _c = pddk[i]['c'];
                    if (_c == channelVal) {
                        bdlist = pddk[i]['b'];
                        break;
                    }
                }
                for (var i = 0; i < bdlist.length; i++) {
                    item += '<option value="' + bdlist[i] + '">' + bdlist[i] + 'M</option>';
                }
                if (wifiname == 'wifiset24') {
                    $bandwidth.html(item).val('20');
                    $itemBandwidth
                        .find('.dummy')
                        .text("20M");
                } else {
                    $bandwidth.html(item).val('0');
                    $itemBandwidth
                        .find('.dummy')
                        .text("自动");
                }

                $itemBandwidth.show();
                var channelIsBad = /36|40|44|48|52|56|60|64/.test(channelVal);

                if (channelIsBad) {
                    tips.html('你手工选择的当前信道有可能造成部分机型较旧的设备无法连接');
                } else {
                    tips.html('');
                }
            });
        });

        $.sub('wifi:bindEvent', function (evt, data) {

            function wifiSubmitHandler(e) {
                e.preventDefault();
                var formOjb = this,
                    formAction = this.action,
                    validator = Valid.checkAll(formOjb);
                if (validator) {
                    var wifiIndex = $('input[name=wifiIndex]', formOjb).val(),
                        on = $('input[name=on]:checked', formOjb).val(),
                        pwd = $('input[name=pwd]', formOjb).val(),
                        ssid = $('input[name=ssid]', formOjb).val(),
                        encryption = $('select[name=encryption]', formOjb).val(),
                        channel = $('select[name=channel]', formOjb).val(),
                        bandwidth = $('select[name=bandwidth]', formOjb).val(),
                        txpwr = $('select[name=txpwr]', formOjb).val(),
                        hidden = $('input[name=hidden]', formOjb).prop('checked') ? '1' : '0';
                    pwd = $.pwddecode(pwd);

                    var requestData = {
                        wifiIndex: wifiIndex,
                        on: on,
                        ssid: ssid,
                        pwd: pwd,
                        encryption: encryption,
                        channel: channel,
                        bandwidth: bandwidth,
                        hidden: hidden,
                        txpwr: txpwr
                    };

                    $.pub('wifi:confirm', {
                        ok: function () {
                            $.pub('wifi:modify', {
                                requestData: requestData,
                                url: formAction
                            });
                        },
                        cancel: function () {
                        }
                    });
                }
            }

            function wifiGuestSubmitHandler(e) {
                e.preventDefault();
                e.preventDefault();
                var formOjb = this,
                    formAction = this.action,
                    validator = Valid.checkAll(formOjb);
                if (validator) {
                    var wifiIndex = $('input[name=wifiIndex]', formOjb).val(),
                        on = $('input[name=on]:checked', formOjb).val(),
                        pwd = $('input[name=pwd]', formOjb).val(),
                        ssid = $('input[name=ssid]', formOjb).val(),
                        encryption = $('select[name=encryption]', formOjb).val();
                    pwd = $.pwddecode(pwd);

                    var ssid24 = global.wifi.configs[1].ssid;
                    if (ssid == ssid24) {
                        Valid.fail($('input[name=ssid]', formOjb)[0], '访客SSID和2.4G SSID不能相同', true);
                        return;
                    }
                    var requestData = {
                        wifiIndex: wifiIndex,
                        on: on,
                        ssid: ssid,
                        pwd: pwd,
                        encryption: encryption
                    };

                    $.pub('wifi:confirm', {
                        ok: function () {
                            $.pub('wifi:modify', {
                                requestData: requestData,
                                url: formAction
                            });
                        },
                        cancel: function () {
                        }
                    });
                }
            }

            function bsdWiFiSubmitHandler(e) {
                e && e.preventDefault();
                var bsd = $('#bsdswitch').attr('data-on') == 1 ? 1 : 0;
                var topContainer = $('#wifisetbsdtop');
                var form1 = $('#wifiset24');
                var form2 = $('#wifiset50');
                var on1 = $('input[name=on]:checked', topContainer).val(),
                    ssid1 = $('input[name=ssid]', topContainer).val(),
                    pwd1 = $('input[name=pwd]', topContainer).val(),
                    encryption1 = $('select[name=encryption]', topContainer).val(),
                    hidden1 = $('input[name=hidden]', topContainer).prop('checked') ? '1' : '0';
                channel1 = $('select[name=channel]', form1).val(),
                    bandwidth1 = $('select[name=bandwidth]', form1).val(),
                    txpwr1 = $('select[name=txpwr]', form1).val(),
                    pwd1 = $.pwddecode(pwd1),
                    on2 = on1,
                    ssid2 = ssid1,
                    pwd2 = pwd1,
                    encryption2 = encryption1,
                    hidden2 = hidden1,
                    channel2 = $('select[name=channel]', form2).val(),
                    bandwidth2 = $('select[name=bandwidth]', form2).val(),
                    txpwr2 = $('select[name=txpwr]', form2).val();
                var requestData = {
                    bsd: bsd,
                    on1: on1,
                    ssid1: ssid1,
                    encryption1: encryption1,
                    channel1: channel1,
                    bandwidth1: bandwidth1,
                    hidden1: hidden1,
                    txpwr1: txpwr1,
                    pwd1: pwd1,
                    on2: on2,
                    ssid2: ssid2,
                    encryption2: encryption2,
                    channel2: channel2,
                    bandwidth2: bandwidth2,
                    hidden2: hidden2,
                    txpwr2: txpwr2,
                    pwd2: pwd2
                };
                $.ajax({
                    url: '/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/api/xqnetwork/set_all_wifi',
                    dataType: 'json',
                    timeout: 5000,
                    type: 'POST',
                    data: requestData,
                    success: function (rsp) {
                        if (rsp.code === 0) {
                            $.pub('wifi:success');
                        } else {
                            if (rsp.code !== 401) {
                                var msg = StringH.encode4Html(rsp.msg);
                                $.alert(msg).lock();
                            }
                        }
                    },
                    error: function () {
                        $.alert('网络异常，请检查是否联网');
                    }
                });
            }

            $('#wifiset24').delegate('[name=on]', 'click', function (e) {
                var val = $(this).val();
                if (global.wifi.configs[3] && global.wifi.configs[3].status) {
                    var wifigueststatus = global.wifi.configs[3].status;
                    var netModeType = parseInt('0');
                    if (val != wifigueststatus) {
                        if (val == 0 && netModeType !== 2) {
                            $.alert('关闭2.4G Wi-Fi会同时关闭访客Wi-Fi').time(3000);
                        }
                    }
                }
            });

            $('body').delegate('#wifisetbsd input[name=on]', 'click', function (e) {
                var val = $(this).val();
                if (global.wifi.configs[3] && global.wifi.configs[3].status) {
                    var wifigueststatus = global.wifi.configs[3].status;
                    var netModeType = parseInt('0');
                    if (val != wifigueststatus) {
                        if (val == 0 && netModeType !== 2) {
                            $.alert('关闭Wi-Fi会同时关闭访客Wi-Fi').time(3000);
                        }
                    }
                }
            });

            $('#wifisetguest').delegate('[name=on]', 'click', function (e) {
                var val = $(this).val();
                var wifi24status = global.wifi.configs[1].status;
                if (val != wifi24status) {
                    if (val == 1) {
                        $.alert('打开访客Wi-Fi会同时打开Wi-Fi').time(3000);
                    }
                }
            });

            $('#wifiset24').on('submit', wifiSubmitHandler);
            $('#wifiset50').on('submit', wifiSubmitHandler);
            $('#wifisetguest').on('submit', wifiGuestSubmitHandler);
            $('body').delegate('#wifisetbsd', 'submit', bsdWiFiSubmitHandler);

            $('body').delegate('input[name=ssid]', 'blur', function (e) {
                var tar = e.currentTarget;
                if (escape(tar.value).indexOf("%u") >= 0) {
                    $(tar.parentNode).next('.t').text('少数设备可能不支持中文或特殊字符').show();
                }
            });

            $('#wifiset24, #wifiset50, #wifisetguest').delegate('input[type=text], input[type=checkbox], input[type=radio]', 'click', onControlFocus)
                .delegate('.ipt-text', 'click', onControlFocus);
            $('#txbfswitch').on('click', function (e) {
                e.preventDefault();
                var txbf = $(this).attr('data-on') == 1 ? 0 : 3;
                var self = this;

                var requestData = {
                    wifiIndex: 2,
                    txbf: txbf
                };
                $.ajax({
                    url: '/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/api/xqnetwork/set_wifi',
                    dataType: 'json',
                    timeout: 5000,
                    type: 'POST',
                    data: requestData,
                    success: function (rsp) {
                        if (rsp.code === 0) {
                            if (txbf == 0) {
                                $(self)
                                    .removeClass('btn-switch-on')
                                    .addClass('btn-switch-off')
                                    .attr('data-on', '0');
                            } else {
                                $(self)
                                    .removeClass('btn-switch-off')
                                    .addClass('btn-switch-on')
                                    .attr('data-on', '1');
                            }

                            $.pub('wifi:success');
                        } else {
                            if (rsp.code !== 401) {
                                var msg = StringH.encode4Html(rsp.msg);
                                $.alert(msg).lock();
                            }
                        }
                    },
                    error: function () {
                        $.alert('网络异常，请检查是否联网');
                    }
                });

            });
            $('#bsdswitch').on('click', function (e) {
                e.preventDefault();
                var on = $(this).attr('data-on');
                var self = this;
                if (on == 0) {
                    var formOjb = $('#wifiset24');
                    var on1 = $('input[name=on]:checked', formOjb).val(),
                        ssid1 = $('input[name=ssid]', formOjb).val(),
                        pwd1 = $('input[name=pwd]', formOjb).val(),
                        encryption1 = $('select[name=encryption]', formOjb).val(),
                        channel1 = $('select[name=channel]', formOjb).val(),
                        bandwidth1 = $('select[name=bandwidth]', formOjb).val(),
                        hidden1 = $('input[name=hidden]', formOjb).prop('checked') ? '1' : '0',
                        txpwr1 = $('select[name=txpwr]', formOjb).val(),
                        pwd1 = $.pwddecode(pwd1);
                    var requestData = {
                        bsd: 1,
                        on1: on1,
                        ssid1: ssid1,
                        encryption1: encryption1,
                        channel1: channel1,
                        bandwidth1: bandwidth1,
                        hidden1: hidden1,
                        txpwr1: txpwr1,
                        pwd1: pwd1
                    };
                    $.ajax({
                        url: '/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/api/xqnetwork/set_all_wifi',
                        dataType: 'json',
                        timeout: 5000,
                        type: 'POST',
                        data: requestData,
                        success: function (rsp) {
                            if (rsp.code === 0) {
                                $(self)
                                    .removeClass('btn-switch-off')
                                    .addClass('btn-switch-on')
                                    .attr('data-on', '1');
                                $.pub('wifi:success');
                            } else {
                                if (rsp.code !== 401) {
                                    var msg = StringH.encode4Html(rsp.msg);
                                    $.alert(msg).lock();
                                }
                            }
                        },
                        error: function () {
                            $.alert('网络异常，请检查是否联网');
                        }
                    });
                } else {
                    $.dialog({
                        width: 390,
                        title: "提示信息",
                        content: 'WiFi双频合一关闭，5G会默认使用2.4G相同的网络名称（加后缀_5G）和密码，如需设成不一样，请进行修改。',
                        ok: function () {
                            $(self)
                                .removeClass('btn-switch-on')
                                .addClass('btn-switch-off')
                                .attr('data-on', '0');
                            setTimeout(function () {
                                bsdWiFiSubmitHandler();
                            }, 0);
                        }
                    });
                }
            });
        });

        $.sub('wifi:success', function (evt, data) {
            $.loadingDialog({
                title: '修改 Wi-Fi 设置',
                content: '设置成功正在重启，需要30秒请等待...',
                cancel: false
            }).lock().time(30 * 1000);
            setTimeout(function () {
                window.location.reload(true);
            }, 30 * 1000);
        });

        $.sub('wifi:confirm', function (evt, data) {
            var ok = data.ok || function () {
                },
                cancel = data.cancel || function () {
                };

            $.dialog({
                id: "confirm",
                width: 390,
                title: "修改Wi-Fi设置",
                content: '该操作将重启 Wi-Fi 并导致 Wi-Fi 下的所有设备失去连接，是否确认修改？',
                ok: function () {
                    ok();
                },
                cancel: function () {
                    cancel();
                }
            }).lock();
        });

        $.sub('wifi:modify', function (evt, data) {
            var requestData = data.requestData;
            var url = data.url;
            $.ajax({
                url: url,
                dataType: 'json',
                timeout: 5000,
                type: "POST",
                data: requestData,
                success: function (rsp) {
                    if (rsp.code === 0) {
                        $.pub('wifi:success');
                    } else {
                        if (rsp.code !== 401) {
                            var msg = StringH.encode4Html(rsp.msg);
                            $.alert(msg).lock();
                        }
                    }
                },
                error: function () {
                    $.alert('网络异常，请检查是否联网');
                }
            });
        });

        $.sub('wifi:txpwr', function (evt, data) {
            var txpwr = '',
                setTxpwr = function (root, data) {
                    var that = root,
                        requestData = data,
                        requestURL = '/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/api/xqnetwork/set_wifi_txpwr';

                    return function () {
                        $.getJSON(requestURL, requestData, function (rsp) {
                            if (rsp.code === 0) {
                                $.loadingDialog({
                                    title: 'Wi-Fi 信号强度设置',
                                    content: '设置已经生效，等待30秒后 Wi-Fi 重启。'
                                }).lock().time(30 * 1000);

                                setTimeout(function () {
                                    window.location.reload(1);
                                }, 30 * 1000);

                            } else {
                                $.alert(rsp.msg);
                            }
                        });
                    };
                };

            $('#wifiSetTxpwr').on('submit', function (e) {
                e.preventDefault();
                var that = this,
                    requestData = {
                        txpwr: $('#txpwr').val()
                    },
                    ok;

                if (requestData.txpwr === txpwr) {
                    $.alert('你什么都没改变，提交什么啊');
                    return;
                }

                ok = setTxpwr(that, requestData);

                $.pub('wifi:confirm', {
                    ok: ok,
                    cancel: function () {
                    }
                });
            });
        });

        $.sub('countrycode', function (evt, data) {
            var apiGet = '/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/api/xqsystem/country_code',
                apiSet = '/cgi-bin/luci/;stok=aa529b79ff9275ecb523d6a244e4a6b9/api/xqsystem/set_country_code',
                $select = $('#countrycode');

            $.get(apiGet, function (rsp) {
                var rsp = $.parseJSON(rsp);
                var selectContent = [];
                if (rsp.code == 0) {
                    for (var i = 0; i < rsp.list.length; i++) {
                        var item = rsp.list[i],
                            selected = item.code == rsp.current ? 'selected' : '',
                            option = '<option value="' + item.code + '" ' + selected + '>' + item['name'] + '</option>';
                        selectContent.push(option);
                    }
                    ;
                    $select.html(selectContent.join(''));
                }
                $.selectBeautify({container: '#countrycode'});
            });

            $select.on('change', function (e) {
                var el = this,
                    val = $(this).val();
                $.confirm('切换国家或地区将会变更路由器的无线网络工作信道，需要重启后生效，是否确定？', function () {
                    $.post(apiSet, {country: val}, function (rsp) {
                        var rsp = $.parseJSON(rsp);
                        if (rsp.code == 0) {
                            rebootWait({action: '切换国家或地区', refresh: true});
                        } else {
                            $.alert(rsp.msg);
                        }
                    });
                })

            });
        });


        $(function () {
            $.selectBeautify();
            $.formInit();
            $.pub('setpassword');
//            $.pub('wifi:init');
//            $.pub('wifi:bindEvent');
//            $.pub('wifi:txpwr');
//            $.pub('countrycode');
        });


    }());
    $.sub('setpassword', function () {
        // set password
        $('#setRouterPwd').on('submit', function (e) {
            e.preventDefault();
            var requestURL = '/cgi-bin/safe.lua',
                requestData = {},
                formObj = this,
                formName = formObj.name,
                oldPwd,
                _oldPwd,
                _newPwd,
                newPwd,
                nonce,
                validator = Valid.checkAll(formObj);
            if (validator) {
                _oldPwd = $('input[name=oldPwd]').val();
                _newPwd = $('input[name=newPwd]').val();

                requestData = {
                    setcfg: '0',
                    newPwd: _newPwd,
                    oldPwd: _oldPwd,
                    username:$('#username').val()
                };
                console.log(requestData);
                if (_oldPwd === _newPwd) {
                    $.alert('新密码与原密码相同');
                    return;
                }
                $.pub('wait', {
                    id: '#btnSetRouterPwd'
                });
                $.ajax({
                    url: requestURL,
                    dataType: 'json',
                    timeout: 5000, //3 second timeout
                    type: "POST",
                    data: requestData,
                    success: function (rsp) {
                        console.log(rsp);
                        if (rsp.code == 0) {
                            $.alert('设置成功').time(1.5 * 1000);
                            setTimeout('location.reload( true )', 2000);
                        } else {
                            $.alert(rsp.info);
                        }
                        $.pub('done', {
                            id: '#btnSetRouterPwd'
                        });
                    }
                });
            }
        });
    });
</script>

<script>

    $(function () {
        getData()
        getfoot()
    })
    function getData() {
        $.post("/cgi-bin/safe.lua", {getcfg: 0}, function (response, status, xhr) {
            if (response.code === 0) {
                console.log(response);
                $('#username').val(response.username);
                $.selectBeautify();
                $.formInit();
            }
        }, "json");
    }
    function getfoot() {
        $.post("/cgi-bin/status.lua", {getcfg: 1}, function (response, status, xhr) {
            if (response.code === 0) {
                document.getElementById('ft').innerHTML = template('ft_template', {
                    data: response
                });
            }
        }, "json");
    }


</script>
